<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√ñzel TV - HLS & VTT Destekli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    
    <style>
        :root { --red: #e50914; --bg: #000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        
        /* Giri≈ü */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #auth-screen input { padding: 15px; font-size: 20px; text-align: center; border-radius: 8px; border: 2px solid var(--red); background: #111; color: white; width: 220px; margin-bottom: 20px; }
        
        #main-wrapper { display: none; width: 100%; height: 100%; }
        
        /* Men√º */
        #playlist-container { width: 280px; height: 100%; background: #0a0a0a; position: fixed; left: 0; top: 0; z-index: 100; border-right: 1px solid #222; overflow-y: auto; transition: 0.3s; }
        .playlist-item { padding: 15px; border-bottom: 1px solid #1a1a1a; cursor: pointer; }
        .playlist-item:hover { background: #111; color: var(--red); }
        
        /* Oynatƒ±cƒ± */
        #player-area { position: absolute; left: 280px; right: 0; top: 0; bottom: 0; transition: 0.3s; }
        .full-view #player-area { left: 0; }
        .full-view #playlist-container { transform: translateX(-280px); }
        
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        
        /* Altyazƒ± */
        video::cue { background: rgba(0,0,0,0.8); color: white; font-size: 1.1em; }

        /* Kontroller */
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); padding: 30px 20px 15px; z-index: 200; transition: 0.4s; }
        .ui-hidden .controls { opacity: 0; pointer-events: none; }
        
        .progress-bar { width: 100%; accent-color: var(--red); cursor: pointer; }
        .btns { display: flex; justify-content: space-between; align-items: center; margin-top: 10px; }
        button { background: var(--red); border: none; color: white; padding: 10px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .sec-btn { background: #333; margin-left: 5px; }
        
        .jump-input { width: 50px; background: #222; border: 1px solid #444; color: white; text-align: center; padding: 8px; border-radius: 4px; margin: 0 5px; }
    </style>
</head>
<body onmousemove="resetUI()" onclick="resetUI()">

<div id="auth-screen">
    <h2 style="color:var(--red)">üîë √ñZEL ERƒ∞≈ûƒ∞M</h2>
    <input type="password" id="passInp" placeholder="≈ûifre">
    <button onclick="login()">Gƒ∞Rƒ∞≈û</button>
</div>

<div id="main-wrapper">
    <div id="playlist-container">
        <h3 style="padding:15px; color:var(--red); border-bottom: 1px solid #222;">üì∫ Lƒ∞STEM</h3>
        <div id="list-items"></div>
    </div>

    <div id="player-area">
        <div id="yt-wrap" style="display:none; width:100%; height:100%;"><div id="yt-player"></div></div>
        <video id="v-player" playsinline crossorigin="anonymous"></video>
        
        <div class="controls">
            <input type="range" class="progress-bar" id="seek" value="0" step="0.1">
            <div class="btns">
                <div>
                    <button onclick="togglePlay()" id="playBtn">‚è∏</button>
                    <input type="number" id="jumpMin" class="jump-input" placeholder="DK">
                    <button onclick="doJump()" class="sec-btn">Gƒ∞T</button>
                    <button id="ccBtn" class="sec-btn" onclick="toggleCC()" style="display:none;">CC</button>
                </div>
                <button class="sec-btn" onclick="toggleFS()">‚õ∂ TAM EKRAN</button>
            </div>
        </div>
    </div>
</div>

<script>
    const fbConfig = {
        apiKey: "AIzaSyDVS-jg8FkE9xuUfzlnYboKrqsHHTL3Bvo",
        databaseURL: "https://naberdeneme-ffa04-default-rtdb.firebaseio.com",
        projectId: "naberdeneme-ffa04"
    };

    let ytPlayer, hls, isYT = false, hideTimer;
    const video = document.getElementById('v-player');
    const seek = document.getElementById('seek');

    function login() {
        if(document.getElementById('passInp').value === "755654") {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            if(!firebase.apps.length) firebase.initializeApp(fbConfig);
            loadList();
        } else { alert("Hatalƒ±!"); }
    }

    function resetUI() {
        document.body.classList.remove('ui-hidden');
        clearTimeout(hideTimer);
        hideTimer = setTimeout(() => {
            if(!video.paused || (ytPlayer && ytPlayer.getPlayerState() === 1)) 
                document.body.classList.add('ui-hidden');
        }, 3000);
    }

    function loadList() {
        firebase.database().ref('ozel_videolar').on('value', s => {
            const container = document.getElementById('list-items');
            container.innerHTML = "";
            s.forEach(child => {
                const item = child.val();
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.innerHTML = `<b>${item.title}</b>`;
                div.onclick = () => playNow(item);
                container.appendChild(div);
            });
        });
    }

    async function playNow(data) {
        // Sƒ±fƒ±rlama
        if(hls) { hls.destroy(); hls = null; }
        video.pause();
        while(video.firstChild) video.removeChild(video.firstChild);
        
        isYT = data.v_url.includes('youtube.com') || data.v_url.includes('youtu.be');

        if(isYT) {
            document.getElementById('yt-wrap').style.display = 'block';
            video.style.display = 'none';
            const id = data.v_url.split('v=')[1]?.split('&')[0] || data.v_url.split('embed/')[1];
            if(!ytPlayer) {
                ytPlayer = new YT.Player('yt-player', { height:'100%', width:'100%', videoId:id, playerVars:{'controls':0, 'autoplay':1} });
            } else { ytPlayer.loadVideoById(id); }
            document.getElementById('ccBtn').style.display = 'none';
        } else {
            document.getElementById('yt-wrap').style.display = 'none';
            video.style.display = 'block';

            // M3U8 Oynatma Mantƒ±ƒüƒ±
            if (data.v_url.includes('.m3u8')) {
                if (Hls.isSupported()) {
                    hls = new Hls();
                    hls.loadSource(data.v_url);
                    hls.attachMedia(video);
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = data.v_url;
                }
            } else {
                video.src = data.v_url;
            }

            // Altyazƒ± (Proxy ile √ßekme)
            if(data.vtt_url) {
                document.getElementById('ccBtn').style.display = 'inline-block';
                try {
                    const proxy = "https://api.allorigins.win/raw?url=" + encodeURIComponent(data.vtt_url);
                    const res = await fetch(proxy);
                    const blob = await res.blob();
                    const track = document.createElement('track');
                    track.kind = 'captions'; track.label = 'T√ºrk√ße'; track.srclang = 'tr';
                    track.src = URL.createObjectURL(blob);
                    track.default = true;
                    video.appendChild(track);
                } catch(e) { console.error("CC Hatasƒ±"); }
            }
            video.play();
        }
        syncLoop();
    }

    function togglePlay() {
        if(isYT) { ytPlayer.getPlayerState() === 1 ? ytPlayer.pauseVideo() : ytPlayer.playVideo(); }
        else { video.paused ? video.play() : video.pause(); }
    }

    function doJump() {
        const val = document.getElementById('jumpMin').value * 60;
        if(isYT) ytPlayer.seekTo(val); else video.currentTime = val;
    }

    function syncLoop() {
        const cur = isYT ? ytPlayer?.getCurrentTime() : video.currentTime;
        const dur = isYT ? ytPlayer?.getDuration() : video.duration;
        if(dur) { seek.max = dur; seek.value = cur; }
        const playing = isYT ? (ytPlayer?.getPlayerState() === 1) : !video.paused;
        document.getElementById('playBtn').innerText = playing ? "‚è∏" : "‚ñ∂";
        requestAnimationFrame(syncLoop);
    }

    seek.oninput = () => { if(isYT) ytPlayer.seekTo(seek.value); else video.currentTime = seek.value; };

    function toggleCC() {
        const t = video.textTracks[0];
        if(t) t.mode = t.mode === 'showing' ? 'hidden' : 'showing';
    }

    function toggleFS() {
        if(!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
            document.body.classList.add('full-view');
        } else {
            document.exitFullscreen();
            document.body.classList.remove('full-view');
        }
    }
</script>
</body>
</html>
