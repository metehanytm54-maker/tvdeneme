<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√ñzel TV Pro - Altyazƒ± Destekli</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root { --primary: #e50914; --bg: #000; --panel: #111; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow: hidden; }
        
        /* Giri≈ü Ekranƒ± */
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #auth-screen input { padding: 15px; font-size: 25px; text-align: center; border-radius: 10px; border: 2px solid var(--primary); background: #111; color: white; width: 250px; margin-bottom: 20px; }
        
        #main-player { display: none; }
        
        /* UI Kontrolleri */
        .ui-hidden-active #playlist-container, .ui-hidden-active .controls-bar { opacity: 0; visibility: hidden; }
        #playlist-container, .controls-bar { transition: all 0.5s ease; opacity: 1; visibility: visible; }
        
        #playlist-container { padding: 20px; height: 100vh; overflow-y: auto; width: 280px; background: var(--panel); position: fixed; left: 0; top: 0; z-index: 10; border-right: 1px solid #333; }
        .playlist-item { background: #1a1a1a; padding: 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; outline: none; }
        .playlist-item:focus, .playlist-item:hover { border-color: var(--primary); background: #222; }
        
        #player-main { margin-left: 280px; height: 100vh; position: relative; background: #000; display: flex; align-items: center; justify-content: center; }
        .is-fullscreen #player-main { margin-left: 0; width: 100vw; }
        .is-fullscreen #playlist-container { transform: translateX(-280px); }
        
        .media-layer { position: absolute; width: 100%; height: 100%; top: 0; left: 0; display: none; }
        video { width: 100%; height: 100%; object-fit: contain; outline: none; }

        /* Altyazƒ± Tasarƒ±mƒ± (Kritik) */
        video::cue { background: rgba(0,0,0,0.8); color: #ffffff; font-size: 1.1em; font-weight: bold; }

        .controls-bar { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.95)); padding: 40px 20px 25px; z-index: 20; }
        input[type="range"] { width: 100%; accent-color: var(--primary); cursor: pointer; height: 6px; }
        
        .row { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; flex-wrap: wrap; gap: 10px; }
        .btn-group { display: flex; gap: 10px; align-items: center; }
        
        button { background: var(--primary); border: none; color: white; padding: 10px 18px; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 14px; }
        button.secondary { background: #333; }
        button.active { background: #2e7d32; border: 1px solid #fff; }

        .jump-box { display: flex; align-items: center; background: #222; border-radius: 5px; border: 1px solid #444; }
        .jump-box input { background: transparent; border: none; color: white; width: 45px; text-align: center; padding: 8px; outline: none; }
    </style>
</head>
<body onmousemove="showUI()" onkeydown="showUI()">

<div id="auth-screen">
    <h1 style="color:var(--primary)">üåü √ñZEL Sƒ∞STEM</h1>
    <input type="password" id="tvPass" placeholder="≈ûifre">
    <button onclick="verifyTV()">Gƒ∞Rƒ∞≈û YAP</button>
</div>

<div id="main-player">
    <div id="playlist-container">
        <h3 style="color:var(--primary)">üé¨ √ñZEL Lƒ∞STE</h3>
        <div id="list-items">Y√ºkleniyor...</div>
    </div>

    <div id="player-main">
        <div id="yt-layer" class="media-layer"><div id="yt-player"></div></div>
        <div id="file-layer" class="media-layer">
            <video id="mainVideo" playsinline crossorigin="anonymous" onclick="togglePlay()"></video>
        </div>
        
        <div class="controls-bar">
            <input type="range" id="progressBar" value="0" min="0" step="0.1" oninput="manualSeek(this.value)">
            <div class="row">
                <div class="btn-group">
                    <button id="playBtn" onclick="togglePlay()">‚è∏ DURDUR</button>
                    
                    <div class="jump-box">
                        <input type="number" id="minInput" placeholder="DK">
                        <button onclick="jumpToMin()" style="background:#444; border-radius:0;">Gƒ∞T</button>
                    </div>

                    <button id="ccBtn" class="secondary" onclick="toggleCC()">CC: KAPALI</button>
                </div>

                <div class="btn-group">
                    <button class="secondary" onclick="toggleFS()">‚õ∂ TAM EKRAN</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const config = {
        apiKey: "AIzaSyDVS-jg8FkE9xuUfzlnYboKrqsHHTL3Bvo",
        databaseURL: "https://naberdeneme-ffa04-default-rtdb.firebaseio.com",
        projectId: "naberdeneme-ffa04"
    };

    let ytPlayer, isYouTube = false, idleTimer;
    const video = document.getElementById('mainVideo');
    const bar = document.getElementById('progressBar');

    function verifyTV() {
        if(document.getElementById('tvPass').value === "755654") {
            document.getElementById('auth-screen').style.display = "none";
            document.getElementById('main-player').style.display = "block";
            if (!firebase.apps.length) firebase.initializeApp(config);
            loadPlaylist();
        } else { alert("≈ûifre Hatalƒ±!"); }
    }

    function showUI() {
        clearTimeout(idleTimer);
        document.body.classList.remove('ui-hidden-active');
        idleTimer = setTimeout(() => {
            const isPlaying = isYouTube ? (ytPlayer && ytPlayer.getPlayerState() === 1) : !video.paused;
            if(isPlaying) document.body.classList.add('ui-hidden-active');
        }, 5000);
    }

    function loadPlaylist() {
        firebase.database().ref('ozel_videolar').on('value', snap => {
            const container = document.getElementById('list-items');
            container.innerHTML = "";
            snap.forEach(child => {
                const v = child.val();
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.tabIndex = "0";
                div.innerHTML = `<b>${v.title}</b> ${v.vtt_url ? '<small>(CC)</small>' : ''}`;
                div.onclick = () => playMedia(v);
                container.appendChild(div);
            });
        });
    }

    function playMedia(v) {
        // Temizlik
        while (video.firstChild) video.removeChild(video.firstChild);
        isYouTube = v.v_url.includes('youtube') || v.v_url.includes('youtu.be');
        
        if(isYouTube) {
            document.getElementById('yt-layer').style.display = 'block';
            document.getElementById('file-layer').style.display = 'none';
            const vidId = v.v_url.split('v=')[1] || v.v_url.split('embed/')[1];
            if(!ytPlayer) {
                ytPlayer = new YT.Player('yt-player', {
                    height: '100%', width: '100%',
                    videoId: vidId,
                    playerVars: { 'controls': 0, 'autoplay': 1, 'cc_load_policy': 1, 'rel':0 }
                });
            } else { ytPlayer.loadVideoById(vidId); }
            document.getElementById('ccBtn').style.display = 'none'; // YouTube i√ßin buton pasif
        } else {
            document.getElementById('yt-layer').style.display = 'none';
            document.getElementById('file-layer').style.display = 'block';
            document.getElementById('ccBtn').style.display = 'block';

            if(v.vtt_url) {
                const track = document.createElement('track');
                track.id = "main-track";
                track.kind = 'captions';
                track.label = 'T√ºrk√ße';
                track.srclang = 'tr';
                track.src = v.vtt_url;
                track.default = true;
                video.appendChild(track);
                
                // Altyazƒ± durumunu butona yansƒ±t
                document.getElementById('ccBtn').className = "active";
                document.getElementById('ccBtn').innerText = "CC: A√áIK";
            } else {
                document.getElementById('ccBtn').style.display = 'none';
            }

            video.src = v.v_url;
            video.load();
            video.play().catch(e => console.log("Oynatma hatasƒ±:", e));
        }
        requestAnimationFrame(sync);
    }

    // ALTYAZI A√á/KAPAT FONKSƒ∞YONU
    function toggleCC() {
        if (video.textTracks && video.textTracks.length > 0) {
            const track = video.textTracks[0];
            const btn = document.getElementById('ccBtn');
            
            if (track.mode === 'showing') {
                track.mode = 'hidden';
                btn.className = "secondary";
                btn.innerText = "CC: KAPALI";
            } else {
                track.mode = 'showing';
                btn.className = "active";
                btn.innerText = "CC: A√áIK";
            }
        }
    }

    function jumpToMin() {
        const m = document.getElementById('minInput').value;
        if(m !== "") manualSeek(m * 60);
        document.getElementById('minInput').value = "";
    }

    function manualSeek(s) {
        if(isYouTube) ytPlayer.seekTo(s); else video.currentTime = s;
    }

    function togglePlay() {
        const playing = isYouTube ? (ytPlayer.getPlayerState() === 1) : !video.paused;
        const btn = document.getElementById('playBtn');
        if(playing) {
            if(isYouTube) ytPlayer.pauseVideo(); else video.pause();
            btn.innerText = "‚ñ∂ OYNAT";
        } else {
            if(isYouTube) ytPlayer.playVideo(); else video.play();
            btn.innerText = "‚è∏ DURDUR";
        }
        showUI();
    }

    function sync() {
        try {
            const cur = isYouTube ? (ytPlayer && ytPlayer.getCurrentTime ? ytPlayer.getCurrentTime() : 0) : video.currentTime;
            const dur = isYouTube ? (ytPlayer && ytPlayer.getDuration ? ytPlayer.getDuration() : 0) : video.duration;
            if(dur > 0) { bar.max = dur; bar.value = cur; }
        } catch(e) {}
        requestAnimationFrame(sync);
    }

    function toggleFS() {
        if (!document.fullscreenElement) document.documentElement.requestFullscreen();
        else document.exitFullscreen();
    }
</script>
</body>
</html>
