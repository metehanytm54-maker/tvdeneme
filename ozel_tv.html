<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√ñzel TV Oynatƒ±cƒ± - Tam Ekran Fix</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        body { background: #000; color: white; font-family: sans-serif; margin: 0; overflow: hidden; width: 100vw; height: 100vh; }
        
        #auth-screen { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #auth-screen input { padding: 20px; font-size: 25px; text-align: center; border-radius: 12px; border: 2px solid #e50914; background: #111; color: white; width: 260px; margin-bottom: 20px; }
        
        #main-player { display: none; width: 100%; height: 100%; position: relative; }
        
        /* UI Gizleme Sƒ±nƒ±fƒ± */
        .ui-hidden-active #playlist-container, 
        .ui-hidden-active .controls-bar { opacity: 0 !important; visibility: hidden !important; pointer-events: none; }
        
        #playlist-container { padding: 20px; height: 100%; width: 280px; background: #111; position: absolute; left: 0; top: 0; z-index: 100; border-right: 1px solid #333; overflow-y: auto; transition: transform 0.3s, opacity 0.5s; }
        
        /* Oynatƒ±cƒ± Alanƒ± */
        #player-main { position: absolute; left: 280px; right: 0; top: 0; bottom: 0; background: #000; display: flex; align-items: center; justify-content: center; transition: all 0.3s; }
        
        /* TAM EKRAN MODU CSS */
        body.is-fullscreen #player-main { left: 0 !important; width: 100% !important; z-index: 999; }
        body.is-fullscreen #playlist-container { transform: translateX(-280px); }

        .media-layer { width: 100%; height: 100%; display: none; }
        video { width: 100%; height: 100%; object-fit: contain; background: #000; }
        
        .controls-bar { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); padding: 60px 20px 20px; z-index: 1000; transition: opacity 0.5s; }
        button { background: #e50914; border: none; color: white; padding: 12px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .sec-btn { background: #333; margin-left: 10px; }
        
        input[type="range"] { width: 100%; accent-color: #e50914; margin-bottom: 10px; }
    </style>
</head>
<body onmousemove="showUI()" onclick="showUI()">

<div id="auth-screen">
    <h2 style="color:#e50914">√ñZEL Sƒ∞STEM</h2>
    <input type="password" id="tvPass" placeholder="≈ûifre">
    <button onclick="verifyTV()">Gƒ∞Rƒ∞≈û YAP</button>
</div>

<div id="main-player">
    <div id="playlist-container">
        <h3 style="color:#e50914">üì∫ KANALLAR</h3>
        <div id="list-items">Y√ºkleniyor...</div>
    </div>

    <div id="player-main">
        <div id="yt-layer" class="media-layer"><div id="yt-player"></div></div>
        <div id="file-layer" class="media-layer">
            <video id="mainVideo" playsinline crossorigin="anonymous"></video>
        </div>
        
        <div class="controls-bar">
            <input type="range" id="progressBar" value="0" step="0.1" oninput="manualSeek(this.value)">
            <div style="display:flex; justify-content:space-between;">
                <button onclick="togglePlay()" id="playBtn">‚è∏ DURDUR</button>
                <button class="sec-btn" onclick="requestFull()">‚õ∂ TAM EKRAN</button>
            </div>
        </div>
    </div>
</div>

<script>
    let hls, ytPlayer, isYouTube = false, idleTimer;
    const videoEl = document.getElementById('mainVideo');

    function verifyTV() {
        if(document.getElementById('tvPass').value === "755654") {
            document.getElementById('auth-screen').style.display = "none";
            document.getElementById('main-player').style.display = "block";
            initFirebase();
        } else { alert("Hatalƒ±!"); }
    }

    function initFirebase() {
        const config = {
            apiKey: "AIzaSyDVS-jg8FkE9xuUfzlnYboKrqsHHTL3Bvo",
            databaseURL: "https://naberdeneme-ffa04-default-rtdb.firebaseio.com",
            projectId: "naberdeneme-ffa04"
        };
        if (!firebase.apps.length) firebase.initializeApp(config);
        
        firebase.database().ref('ozel_videolar').on('value', snap => {
            const container = document.getElementById('list-items');
            container.innerHTML = "";
            snap.forEach(child => {
                const v = child.val();
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.style.background = "#1a1a1a"; div.style.padding = "15px"; div.style.marginBottom = "5px"; div.style.cursor = "pointer";
                div.innerHTML = `<b>${v.title}</b>`;
                div.onclick = () => startMedia(v);
                container.appendChild(div);
            });
        });
    }

    function showUI() {
        clearTimeout(idleTimer);
        document.body.classList.remove('ui-hidden-active');
        idleTimer = setTimeout(() => {
            document.body.classList.add('ui-hidden-active');
        }, 4000);
    }

    async function startMedia(v) {
        if(hls) hls.destroy();
        videoEl.pause();
        isYouTube = v.v_url.includes('youtube') || v.v_url.includes('youtu.be');

        if(isYouTube) {
            document.getElementById('yt-layer').style.display = 'block';
            document.getElementById('file-layer').style.display = 'none';
            const vidId = v.v_url.split('v=')[1]?.split('&')[0] || v.v_url.split('embed/')[1];
            if(!ytPlayer) {
                ytPlayer = new YT.Player('yt-player', { height:'100%', width:'100%', videoId:vidId, playerVars:{'controls':0,'autoplay':1} });
            } else { ytPlayer.loadVideoById(vidId); }
        } else {
            document.getElementById('yt-layer').style.display = 'none';
            document.getElementById('file-layer').style.display = 'block';
            
            if(v.v_url.includes('.m3u8')) {
                if(Hls.isSupported()) {
                    hls = new Hls();
                    hls.loadSource(v.v_url);
                    hls.attachMedia(videoEl);
                    hls.on(Hls.Events.MANIFEST_PARSED, () => videoEl.play());
                }
            } else {
                videoEl.src = v.v_url;
                videoEl.play();
            }
        }
        syncProgress();
    }

    function togglePlay() {
        if(isYouTube) {
            ytPlayer.getPlayerState() === 1 ? ytPlayer.pauseVideo() : ytPlayer.playVideo();
        } else {
            videoEl.paused ? videoEl.play() : videoEl.pause();
        }
    }

    function syncProgress() {
        const cur = isYouTube ? ytPlayer?.getCurrentTime() : videoEl.currentTime;
        const dur = isYouTube ? ytPlayer?.getDuration() : videoEl.duration;
        if(dur > 0) { 
            document.getElementById('progressBar').max = dur; 
            document.getElementById('progressBar').value = cur; 
        }
        document.getElementById('playBtn').innerText = (isYouTube ? ytPlayer?.getPlayerState() === 1 : !videoEl.paused) ? "‚è∏ DURDUR" : "‚ñ∂ OYNAT";
        requestAnimationFrame(syncProgress);
    }

    function manualSeek(val) {
        if(isYouTube) ytPlayer.seekTo(val); else videoEl.currentTime = val;
    }

    // GELƒ∞≈ûMƒ∞≈û TAM EKRAN FONKSƒ∞YONU
    function requestFull() {
        const el = document.documentElement;
        
        if (!document.fullscreenElement && !document.webkitFullscreenElement && !document.mozFullScreenElement && !document.msFullscreenElement) {
            // Tam ekrana gir
            if (el.requestFullscreen) el.requestFullscreen();
            else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
            else if (el.mozRequestFullScreen) el.mozRequestFullScreen();
            else if (el.msRequestFullscreen) el.msRequestFullscreen();
            
            document.body.classList.add('is-fullscreen');
        } else {
            // Tam ekrandan √ßƒ±k
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
            else if (document.msExitFullscreen) document.msExitFullscreen();
            
            document.body.classList.remove('is-fullscreen');
        }
    }

    // ESC tu≈üu ile √ßƒ±kƒ±lƒ±rsa CSS'i d√ºzelt
    document.addEventListener('fullscreenchange', () => {
        if (!document.fullscreenElement) document.body.classList.remove('is-fullscreen');
    });
    document.addEventListener('webkitfullscreenchange', () => {
        if (!document.webkitFullscreenElement) document.body.classList.remove('is-fullscreen');
    });
</script>
</body>
</html>
