<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>√ñzel TV - Kesintisiz Oynatƒ±cƒ±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <style>
        :root { --red: #e50914; --dark: #000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--dark); color: #fff; font-family: sans-serif; overflow: hidden; }
        
        /* ≈ûifre Ekranƒ± */
        #auth-screen { position: fixed; inset: 0; background: var(--dark); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #auth-screen input { padding: 15px; font-size: 20px; text-align: center; border-radius: 8px; border: 2px solid var(--red); background: #111; color: #fff; margin-bottom: 20px; width: 200px; }
        
        #main-wrapper { display: none; width: 100%; height: 100%; position: relative; }
        
        /* Sol Men√º */
        #playlist-container { width: 280px; height: 100%; background: #111; position: absolute; left: 0; top: 0; z-index: 100; border-right: 1px solid #333; overflow-y: auto; transition: transform 0.4s ease; }
        .playlist-item { padding: 15px; border-bottom: 1px solid #222; cursor: pointer; transition: 0.3s; }
        .playlist-item:hover { background: #222; color: var(--red); }

        /* Oynatƒ±cƒ± Alanƒ± */
        #player-area { position: absolute; left: 280px; right: 0; top: 0; bottom: 0; background: #000; transition: all 0.4s ease; display: flex; align-items: center; justify-content: center; }
        .full-view #player-area { left: 0; }
        .full-view #playlist-container { transform: translateX(-280px); }

        .media-container { width: 100%; height: 100%; position: relative; }
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        iframe { width: 100%; height: 100%; border: none; }

        /* Altyazƒ± Stili */
        video::cue { background: rgba(0,0,0,0.8); color: #fff; font-size: 18px; font-family: sans-serif; }

        /* Kontrol √áubuƒüu */
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); padding: 40px 20px 20px; z-index: 200; opacity: 1; transition: opacity 0.5s; }
        .ui-hidden .controls { opacity: 0; pointer-events: none; }
        
        .progress-bar { width: 100%; accent-color: var(--red); cursor: pointer; height: 6px; }
        .btns { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        button { background: var(--red); border: none; color: #fff; padding: 10px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .secondary-btn { background: #333; margin-left: 5px; }
        
        .jump-box { display: flex; background: #222; border-radius: 4px; overflow: hidden; margin: 0 10px; }
        .jump-box input { width: 40px; background: none; border: none; color: #fff; text-align: center; }
    </style>
</head>
<body onmousemove="resetTimer()" onclick="resetTimer()">

<div id="auth-screen">
    <h2 style="color:var(--red)">ERƒ∞≈ûƒ∞M KONTROL√ú</h2>
    <input type="password" id="passInput" placeholder="≈ûifre">
    <button onclick="checkAccess()">Gƒ∞Rƒ∞≈û</button>
</div>

<div id="main-wrapper">
    <div id="playlist-container">
        <h3 style="padding:15px; border-bottom:1px solid var(--red)">üì∫ √ñZEL KANAL</h3>
        <div id="list"></div>
    </div>

    <div id="player-area">
        <div class="media-container">
            <div id="yt-wrap" style="display:none; width:100%; height:100%;"><div id="yt-player"></div></div>
            <video id="v-player" playsinline crossorigin="anonymous"></video>
            
            <div class="controls" id="controls">
                <input type="range" class="progress-bar" id="seek" value="0" step="0.1">
                <div class="btns">
                    <div style="display:flex; align-items:center;">
                        <button onclick="playPause()" id="pBtn">‚è∏ DURDUR</button>
                        <div class="jump-box">
                            <input type="number" id="jumpMin" placeholder="DK">
                            <button onclick="jumpToTime()" style="background:#444;">Gƒ∞T</button>
                        </div>
                        <button id="ccBtn" class="secondary-btn" onclick="toggleCC()" style="display:none;">CC: A√áIK</button>
                    </div>
                    <button class="secondary-btn" onclick="toggleFullScreen()">‚õ∂ TAM EKRAN</button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const fb = {
        apiKey: "AIzaSyDVS-jg8FkE9xuUfzlnYboKrqsHHTL3Bvo",
        databaseURL: "https://naberdeneme-ffa04-default-rtdb.firebaseio.com",
        projectId: "naberdeneme-ffa04"
    };

    let ytPlayer, isYT = false, hideTimer;
    const v = document.getElementById('v-player');
    const seek = document.getElementById('seek');

    function checkAccess() {
        if(document.getElementById('passInput').value === "755654") {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            if(!firebase.apps.length) firebase.initializeApp(fb);
            loadData();
        } else { alert("≈ûifre Yanlƒ±≈ü!"); }
    }

    function resetTimer() {
        document.body.classList.remove('ui-hidden');
        clearTimeout(hideTimer);
        hideTimer = setTimeout(() => {
            const playing = isYT ? (ytPlayer?.getPlayerState() === 1) : !v.paused;
            if(playing) document.body.classList.add('ui-hidden');
        }, 4000);
    }

    function loadData() {
        firebase.database().ref('ozel_videolar').on('value', s => {
            const div = document.getElementById('list');
            div.innerHTML = "";
            s.forEach(child => {
                const item = child.val();
                const btn = document.createElement('div');
                btn.className = 'playlist-item';
                btn.innerHTML = `<b>${item.title}</b>`;
                btn.onclick = () => startMedia(item);
                div.appendChild(btn);
            });
        });
    }

    async function startMedia(data) {
        // Sƒ±fƒ±rla
        while (v.firstChild) v.removeChild(v.firstChild);
        v.pause();
        isYT = data.v_url.includes('youtube') || data.v_url.includes('youtu.be');

        if(isYT) {
            document.getElementById('yt-wrap').style.display = 'block';
            v.style.display = 'none';
            const id = data.v_url.split('v=')[1] || data.v_url.split('embed/')[1];
            if(!ytPlayer) {
                ytPlayer = new YT.Player('yt-player', { height:'100%', width:'100%', videoId:id, playerVars:{'controls':0, 'autoplay':1, 'cc_load_policy':1} });
            } else { ytPlayer.loadVideoById(id); }
            document.getElementById('ccBtn').style.display = 'none';
        } else {
            document.getElementById('yt-wrap').style.display = 'none';
            v.style.display = 'block';
            v.src = data.v_url;

            if(data.vtt_url) {
                document.getElementById('ccBtn').style.display = 'inline-block';
                const track = document.createElement('track');
                track.kind = 'captions';
                track.label = 'T√ºrk√ße';
                track.srclang = 'tr';
                track.default = true;

                // CORS PROBLEMI ƒ∞√áƒ∞N PROXY DENEMESƒ∞
                try {
                    // Not: Bazƒ± CDN'ler doƒürudan fetch'e kapalƒ± olabilir. Proxy adresini ba≈üƒ±na ekliyoruz.
                    const proxyUrl = "https://api.allorigins.win/raw?url=" + encodeURIComponent(data.vtt_url);
                    const res = await fetch(proxyUrl);
                    const blob = await res.blob();
                    track.src = URL.createObjectURL(blob);
                } catch(e) {
                    console.warn("Proxy ile y√ºklenemedi, direkt link deneniyor...");
                    track.src = data.v_url;
                }
                
                v.appendChild(track);
            }
            v.play();
        }
        updateSync();
    }

    function playPause() {
        if(isYT) {
            ytPlayer.getPlayerState() === 1 ? ytPlayer.pauseVideo() : ytPlayer.playVideo();
        } else {
            v.paused ? v.play() : v.pause();
        }
        document.getElementById('pBtn').innerText = "ƒ∞≈ûLEM YAPILIYOR...";
    }

    function jumpToTime() {
        const m = document.getElementById('jumpMin').value;
        if(m) {
            const s = m * 60;
            isYT ? ytPlayer.seekTo(s) : (v.currentTime = s);
        }
    }

    function updateSync() {
        const cur = isYT ? ytPlayer?.getCurrentTime() : v.currentTime;
        const dur = isYT ? ytPlayer?.getDuration() : v.duration;
        if(dur) { seek.max = dur; seek.value = cur; }
        
        // Buton Metni G√ºncelleme
        const playing = isYT ? (ytPlayer?.getPlayerState() === 1) : !v.paused;
        document.getElementById('pBtn').innerText = playing ? "‚è∏ DURDUR" : "‚ñ∂ OYNAT";
        
        requestAnimationFrame(updateSync);
    }

    function toggleCC() {
        const t = v.textTracks[0];
        if(t) {
            t.mode = (t.mode === 'showing') ? 'hidden' : 'showing';
            document.getElementById('ccBtn').innerText = `CC: ${t.mode === 'showing' ? 'A√áIK' : 'KAPALI'}`;
        }
    }

    function toggleFullScreen() {
        const doc = document.documentElement;
        const area = document.body;
        
        if (!document.fullscreenElement && !document.webkitFullscreenElement) {
            if (doc.requestFullscreen) doc.requestFullscreen();
            else if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
            area.classList.add('full-view');
        } else {
            if (document.exitFullscreen) document.exitFullscreen();
            else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
            area.classList.remove('full-view');
        }
    }

    // ƒ∞lerleme √ßubuƒüundan kaydƒ±rma
    seek.oninput = () => {
        const val = seek.value;
        isYT ? ytPlayer.seekTo(val) : (v.currentTime = val);
    };

</script>
</body>
</html>
