<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã–zel TV - Nihai Ã‡Ã¶zÃ¼m</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --red: #e50914; --bg: #000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #auth-screen input { padding: 15px; font-size: 20px; text-align: center; border-radius: 8px; border: 2px solid var(--red); background: #111; color: white; width: 220px; margin-bottom: 20px; }
        #main-wrapper { display: none; width: 100%; height: 100%; position: relative; }
        #playlist-container { width: 280px; height: 100%; background: #0a0a0a; position: fixed; left: 0; top: 0; z-index: 100; border-right: 1px solid #222; overflow-y: auto; transition: 0.3s; }
        .playlist-item { padding: 15px; border-bottom: 1px solid #1a1a1a; cursor: pointer; font-size: 14px; }
        #player-area { position: absolute; left: 280px; right: 0; top: 0; bottom: 0; transition: 0.3s; background: #000; }
        .full-view #player-area { left: 0; }
        .full-view #playlist-container { transform: translateX(-280px); }
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); padding: 30px 20px 15px; z-index: 200; }
        button { background: var(--red); border: none; color: white; padding: 10px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        #status-bar { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 8px 12px; font-size: 11px; border-radius: 5px; z-index: 2000; }
    </style>
</head>
<body>

<div id="status-bar">Sistem HazÄ±r</div>

<div id="auth-screen">
    <h2 style="color:var(--red)">ðŸ”‘ ERÄ°ÅžÄ°M</h2>
    <input type="password" id="passInp" placeholder="Åžifre">
    <button onclick="login()">GÄ°RÄ°Åž</button>
</div>

<div id="main-wrapper">
    <div id="playlist-container">
        <h3 style="padding:15px; color:var(--red); border-bottom:1px solid #333;">ðŸŽ¬ LÄ°STEM</h3>
        <div id="list-items"></div>
    </div>
    <div id="player-area">
        <video id="v-player" playsinline crossorigin="anonymous" controls></video>
        <div class="controls">
            <button onclick="toggleFS()" style="float:right; background:#333">â›¶ TAM EKRAN</button>
        </div>
    </div>
</div>

<script>
    const fbConfig = {
        apiKey: "AIzaSyDVS-jg8FkE9xuUfzlnYboKrqsHHTL3Bvo",
        databaseURL: "https://naberdeneme-ffa04-default-rtdb.firebaseio.com",
        projectId: "naberdeneme-ffa04"
    };

    let hls, video = document.getElementById('v-player');

    function log(msg, col="#0f0") { 
        document.getElementById('status-bar').innerText = msg; 
        document.getElementById('status-bar').style.color = col;
    }

    function login() {
        if(document.getElementById('passInp').value === "755654") {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            if(!firebase.apps.length) firebase.initializeApp(fbConfig);
            loadData();
        } else { alert("Åžifre YanlÄ±ÅŸ!"); }
    }

    function loadData() {
        firebase.database().ref('ozel_videolar').on('value', s => {
            const container = document.getElementById('list-items');
            container.innerHTML = "";
            s.forEach(child => {
                const item = child.val();
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.innerHTML = `<b>${item.title}</b>`;
                div.onclick = () => startStream(item.v_url);
                container.appendChild(div);
            });
        });
    }

    function startStream(url) {
        log("BaÄŸlantÄ± Kuruluyor...");
        if(hls) hls.destroy();

        if (Hls.isSupported()) {
            hls = new Hls({
                // BazÄ± m3u8 linklerinde hata payÄ±nÄ± artÄ±rÄ±r
                maxBufferLength: 30,
                maxMaxBufferLength: 600,
                // Ã–nemli: Sunucunun parÃ§alarÄ± (segments) reddetmesini Ã¶nlemek iÃ§in
                xhrSetup: function(xhr, url) {
                    xhr.withCredentials = false;
                }
            });

            // Proxy Zinciri: EÄŸer doÄŸrudan aÃ§Ä±lmazsa Proxy deneyecek
            hls.loadSource(url);
            hls.attachMedia(video);

            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                log("YAYIN BAÅžLADI");
                video.play();
            });

            hls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                    log("AÄŸ KorumasÄ± Tespit Edildi, Bypass Deneniyor...", "orange");
                    // PROXY BYPASS
                    const proxyUrl = "https://worker-orange-water-1673.serdarkaraca.workers.dev/?" + url; 
                    // Not: Bu Ã¶rnek bir proxy worker'dÄ±r. EÄŸer Ã§alÄ±ÅŸmazsa "https://cors-anywhere.herokuapp.com/" deneyebilirsiniz.
                    hls.loadSource(proxyUrl);
                }
            });
        }
    }

    function toggleFS() {
        if(!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
            document.body.classList.add('full-view');
        } else {
            document.exitFullscreen();
            document.body.classList.remove('full-view');
        }
    }
</script>
</body>
</html>
