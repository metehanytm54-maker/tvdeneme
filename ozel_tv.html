<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√ñzel TV - Ultimate Fix</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <style>
        :root { --red: #e50914; --bg: #000; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; }
        #auth-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        #auth-screen input { padding: 15px; font-size: 20px; text-align: center; border-radius: 8px; border: 2px solid var(--red); background: #111; color: white; width: 220px; margin-bottom: 20px; }
        #main-wrapper { display: none; width: 100%; height: 100%; position: relative; }
        #playlist-container { width: 280px; height: 100%; background: #0a0a0a; position: fixed; left: 0; top: 0; z-index: 100; border-right: 1px solid #222; overflow-y: auto; transition: 0.3s; }
        .playlist-item { padding: 15px; border-bottom: 1px solid #1a1a1a; cursor: pointer; }
        #player-area { position: absolute; left: 280px; right: 0; top: 0; bottom: 0; transition: 0.3s; background: #000; }
        .full-view #player-area { left: 0; }
        .full-view #playlist-container { transform: translateX(-280px); }
        video { width: 100%; height: 100%; background: #000; object-fit: contain; }
        .controls { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.9)); padding: 30px 20px 15px; z-index: 200; }
        button { background: var(--red); border: none; color: white; padding: 10px 15px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        #status-bar { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: #0f0; padding: 8px 12px; font-size: 11px; border-radius: 5px; z-index: 2000; border: 1px solid #333; }
    </style>
</head>
<body>

<div id="status-bar">Sistem Beklemede...</div>

<div id="auth-screen">
    <h2 style="color:var(--red)">üîë ERƒ∞≈ûƒ∞M Sƒ∞STEMƒ∞</h2>
    <input type="password" id="passInp" placeholder="≈ûifre">
    <button onclick="login()">Sƒ∞STEME Gƒ∞Rƒ∞≈û</button>
</div>

<div id="main-wrapper">
    <div id="playlist-container">
        <h3 style="padding:15px; color:var(--red);">üé¨ Lƒ∞STEM</h3>
        <div id="list-items"></div>
    </div>
    <div id="player-area">
        <div id="yt-wrap" style="display:none; width:100%; height:100%;"><div id="yt-player"></div></div>
        <video id="v-player" playsinline crossorigin="anonymous"></video>
        <div class="controls">
            <input type="range" style="width:100%; accent-color:red" id="seek" value="0" step="0.1">
            <div style="display:flex; justify-content:space-between; margin-top:10px">
                <button onclick="togglePlay()" id="playBtn">‚è∏ DURDUR</button>
                <button onclick="toggleFS()" style="background:#333">‚õ∂ TAM EKRAN</button>
            </div>
        </div>
    </div>
</div>

<script>
    const fbConfig = {
        apiKey: "AIzaSyDVS-jg8FkE9xuUfzlnYboKrqsHHTL3Bvo",
        databaseURL: "https://naberdeneme-ffa04-default-rtdb.firebaseio.com",
        projectId: "naberdeneme-ffa04"
    };

    let ytPlayer, hls, isYT = false;
    const video = document.getElementById('v-player');
    const status = document.getElementById('status-bar');

    function log(msg, color="#0f0") { status.innerText = msg; status.style.color = color; }

    function login() {
        if(document.getElementById('passInp').value === "755654") {
            document.getElementById('auth-screen').style.display = 'none';
            document.getElementById('main-wrapper').style.display = 'block';
            if(!firebase.apps.length) firebase.initializeApp(fbConfig);
            loadList();
        } else { alert("≈ûifre Hatalƒ±!"); }
    }

    function loadList() {
        firebase.database().ref('ozel_videolar').on('value', s => {
            const container = document.getElementById('list-items');
            container.innerHTML = "";
            s.forEach(child => {
                const item = child.val();
                const div = document.createElement('div');
                div.className = 'playlist-item';
                div.innerHTML = `<b>${item.title}</b>`;
                div.onclick = () => playNow(item);
                container.appendChild(div);
            });
        });
    }

    async function playNow(data) {
        log("Y√ºkleniyor...");
        if(hls) { hls.destroy(); hls = null; }
        video.pause(); video.src = "";
        isYT = data.v_url.includes('youtube.com') || data.v_url.includes('youtu.be');

        if(isYT) {
            document.getElementById('yt-wrap').style.display = 'block';
            video.style.display = 'none';
            const id = data.v_url.split('v=')[1]?.split('&')[0] || data.v_url.split('embed/')[1];
            if(!ytPlayer) {
                ytPlayer = new YT.Player('yt-player', { height:'100%', width:'100%', videoId:id, playerVars:{'autoplay':1} });
            } else { ytPlayer.loadVideoById(id); }
        } else {
            document.getElementById('yt-wrap').style.display = 'none';
            video.style.display = 'block';

            if (data.v_url.includes('.m3u8')) {
                setupHLS(data.v_url);
            } else {
                video.src = data.v_url;
                video.play();
            }
        }
    }

    function setupHLS(url) {
        if (Hls.isSupported()) {
            // HLS Yapƒ±landƒ±rmasƒ±nƒ± G√º√ßlendiriyoruz
            hls = new Hls({
                enableWorker: true,
                lowLatencyMode: true,
                backBufferLength: 90
            });

            log("Manifest Okunuyor...");
            hls.loadSource(url);
            hls.attachMedia(video);

            hls.on(Hls.Events.MANIFEST_PARSED, () => {
                log("Baƒülantƒ± Ba≈üarƒ±lƒ±!");
                video.play();
            });

            hls.on(Hls.Events.ERROR, (event, data) => {
                if (data.fatal) {
                    switch (data.type) {
                        case Hls.ErrorTypes.NETWORK_ERROR:
                            log("Aƒü Hatasƒ±! Proxy Deneniyor...", "orange");
                            // Eƒüer normal link ba≈üarƒ±sƒ±z olursa Proxy kullan
                            if(!url.includes('corsproxy')) {
                                const newUrl = "https://corsproxy.io/?" + encodeURIComponent(url);
                                hls.loadSource(newUrl);
                            } else {
                                log("Manifest Y√ºklenemedi. Link Ge√ßersiz Olabilir.", "red");
                            }
                            break;
                        default:
                            hls.recoverMediaError();
                            break;
                    }
                }
            });
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
    }

    function togglePlay() {
        if(isYT) { (ytPlayer.getPlayerState() === 1) ? ytPlayer.pauseVideo() : ytPlayer.playVideo(); }
        else { video.paused ? video.play() : video.pause(); }
    }

    function toggleFS() {
        if(!document.fullscreenElement) {
            document.documentElement.requestFullscreen();
            document.body.classList.add('full-view');
        } else {
            document.exitFullscreen();
            document.body.classList.remove('full-view');
        }
    }
</script>
</body>
</html>
